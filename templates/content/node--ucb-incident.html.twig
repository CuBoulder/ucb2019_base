{#
/**
 * Theme layout to display a UCB Incident Page.
 *
 * Created by jsparks on 11/21/19
 */
#}

{{ attach_library('ucb2019_base/ucb-incident-page') }}

{%
  set classes = [
  'node',
  'node--type-' ~ node.bundle|clean_class,
  node.isPromoted() ? 'node--promoted',
  node.isSticky() ? 'node--sticky',
  not node.isPublished() ? 'node--unpublished',
  view_mode ? 'node--view-mode-' ~ view_mode|clean_class,
]
%}

{#Dummy variable to ensure that all content tags are set for caching purposes#}
{% set content_render = content|render %}

{% set incidentURL =
  url('<front>')|render|trim('/') ~
  "/jsonapi/node/ucb_incident/" ~ uuid
%}

{% set updatesURL=
  url('<front>')|render|trim('/') ~
  "/jsonapi/paragraph/ucb_incident_update/"
%}


{#  "?filter[self][group][conjunction]=AND" ~#}

{#  "&filter[self-filter][condition][path]=field_ucb_guide_organization.id" ~#}
{#  "&filter[self-filter][condition][operator]=CONTAINS" ~#}
{#  "&filter[self-filter][condition][value]="~ uuid  ~#}
{#  "&filter[self-filter][condition][memberOf]=self"#}

<article{{attributes.addClass(classes)}}>
  <div class="container ucb-incident-container">
    <div class="ucb-incident-row row">
      {#      <h1>{{ label }}</h1>#}
      {% if content.field_ucb_incident_type[0]['#taxonomy_term'].field_ucb_incident_sidebar_boil[0].value|render or content.field_ucb_incident_sidebar_body|render %}
        <div class="ucb-incident-event-col col-sm-12 col-md-8 col-lg-9">
          {{ content.field_ucb_incident_events }}
        </div>
        <div class="ucb-incident-sidebar col-sm-12 col-md-4 col-lg-3">
          {% if content.field_ucb_incident_sidebar_body|render %}
            {{ content.field_ucb_incident_sidebar_body }}
          {% endif %}
          {% if content.field_ucb_incident_type[0]['#taxonomy_term'].field_ucb_incident_sidebar_boil[0].value|render %}
            {{ content.field_ucb_incident_type }}
          {% endif %}
        </div>
      {% else %}
        <h4>Id is {{ uuid }}</h4><br>
        <div id="vue-incident">
          <h5>Showing data...</h5>
          <ucb-incident-event dataurl="{{ incidentURL }}" inline-template>
            <div>
              {#              <h4 v-html="this.$store.state.test"></h4>#}
              {#              <h4 v-html="this.$store.getters.getTest"></h4>#}
              <h4 v-html="TEST"></h4>
              <h4 v-html="INCIDENT_COUNT"></h4>

              <div v-for="updateID in GET_INCIDENT_IDS">
                <div class="ucb-incident-event-card">
                  <h3>ID is : <span v-html="updateID"></span></h3>
                  {#                  <p v-html="GET_INCIDENT_DATA_BY_ID(update)"></p>#}
                  <h2 class="ucb-incident-event-timestamp" v-html="GET_INCIDENT_TIMESTAMP(updateID)"></h2>
                  <div class="ucb-incident-event-body" v-html="GET_INCIDENT_BODY(updateID)"></div>
                  <div class="ucb-incident-event-map" v-html="GET_INCIDENT_MAP(updateID)"></div>
                  {#                    <div class="ucb-incident-event-images row">{{ content.field_ucb_incident_images }}</div>#}
                  <ul class="ucb-incident-event-links">
                    <li v-for="link in GET_INCIDENT_LINKS(updateID)" v-html="link"></li>
                  </ul>
                </div>
              </div>
            </div>

          </ucb-incident-event>
        </div>
        {{ content.field_ucb_incident_events }}
      {% endif %}
      {#        {{ content.field_ucb_incident_type[0]['#taxonomy_term'].field_ucb_incident_sidebar_boil[0].value|raw }}#}
      {#        <ol>#}
      {#          {% for key, value in content.field_ucb_incident_type[0]['#taxonomy_term'].field_ucb_incident_sidebar_boil[0].value  %}#}
      {#            <li>{{ key }}</li>#}
      {#          {% endfor %}#}
      {#        </ol>#}
    </div>
  </div>
</article>
